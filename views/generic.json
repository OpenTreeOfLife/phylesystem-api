{{
try:
    from gluon.serializers import json

    # web2py view expects a dict, but we might have a single JSON response ready
    full_response = response._vars.get('FULL_RESPONSE', None)
    if full_response:
        response.write(json(full_response),escape=False)
    else:
        response.write(json(response._vars),escape=False)
    pass

    response.headers['Content-Type']='application/json'
except:
    raise HTTP(405,'no json')
}}
